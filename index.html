<!DOCTYPE html>
<html>
<head>
  <title>Badari Fashions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100">

<!-- NAVBAR -->
<div class="bg-black text-white p-4 flex justify-between">
  <h1 class="text-xl font-bold">Badari Fashions</h1>
  <div>
    <span id="userEmail"></span>
    <button onclick="logout()" class="ml-4 bg-red-500 px-3 py-1 rounded">Logout</button>
  </div>
</div>

<!-- LOGIN SECTION -->
<div id="loginSection" class="flex justify-center items-center h-screen">
  <div class="bg-white p-6 rounded shadow w-80">
    <h2 class="text-lg font-bold mb-4 text-center">Login / Register</h2>
    <input id="email" type="email" placeholder="Email" class="w-full p-2 border mb-3">
    <input id="password" type="password" placeholder="Password" class="w-full p-2 border mb-3">
    <button onclick="login()" class="w-full bg-blue-500 text-white p-2 rounded">Login</button>
    <button onclick="register()" class="w-full bg-green-500 text-white p-2 rounded mt-2">Register</button>
  </div>
</div>

<!-- MAIN SECTION -->
<div id="mainSection" class="hidden p-6">

  <!-- ADMIN PANEL -->
  <div id="adminPanel" class="hidden bg-white p-4 rounded shadow mb-6">
    <h3 class="font-bold mb-2">Add Product</h3>
    <input id="pname" placeholder="Product Name" class="border p-2 mb-2 w-full">
    <input id="pprice" placeholder="Price" class="border p-2 mb-2 w-full">
    <button onclick="addProduct()" class="bg-black text-white px-4 py-2 rounded">Add</button>
  </div>

  <!-- PRODUCTS -->
  <div id="productList" class="grid grid-cols-2 gap-4"></div>

  <!-- CART -->
  <div class="fixed bottom-4 right-4 bg-white p-4 shadow rounded w-72">
    <h3 class="font-bold">Cart</h3>
    <div id="cartItems"></div>
    <p class="font-bold mt-2">Total: â‚¹<span id="total">0</span></p>
    <button onclick="placeOrder()" class="bg-green-600 text-white w-full mt-2 p-2 rounded">Order via WhatsApp</button>
  </div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ðŸ”´ REPLACE WITH YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let cart = [];
let products = [];
const ADMIN_EMAIL = "8179564372@gmail.com";  // change if needed

// LOGIN
window.login = async function() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await signInWithEmailAndPassword(auth, email, password);
};

// REGISTER
window.register = async function() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await createUserWithEmailAndPassword(auth, email, password);
};

// LOGOUT
window.logout = function() {
  signOut(auth);
};

// AUTH STATE
onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("mainSection").classList.remove("hidden");
    document.getElementById("userEmail").innerText = user.email;

    if(user.email === ADMIN_EMAIL){
      document.getElementById("adminPanel").classList.remove("hidden");
    }

    loadProducts();
  } else {
    document.getElementById("loginSection").classList.remove("hidden");
    document.getElementById("mainSection").classList.add("hidden");
  }
});

// ADD PRODUCT
window.addProduct = async function(){
  const name = document.getElementById("pname").value;
  const price = document.getElementById("pprice").value;

  await addDoc(collection(db, "products"), {
    name: name,
    price: price
  });

  alert("Product Added");
  loadProducts();
};

// LOAD PRODUCTS
async function loadProducts(){
  const querySnapshot = await getDocs(collection(db, "products"));
  products = [];
  document.getElementById("productList").innerHTML = "";

  querySnapshot.forEach(doc => {
    products.push(doc.data());
  });

  products.forEach((p,index)=>{
    document.getElementById("productList").innerHTML += `
      <div class="bg-white p-4 shadow rounded">
        <h4 class="font-bold">${p.name}</h4>
        <p>â‚¹${p.price}</p>
        <button onclick="addToCart(${index})" class="bg-blue-500 text-white px-3 py-1 mt-2 rounded">Add</button>
      </div>
    `;
  });
}

// ADD TO CART
window.addToCart = function(index){
  cart.push(products[index]);
  updateCart();
};

// UPDATE CART
function updateCart(){
  let total = 0;
  document.getElementById("cartItems").innerHTML = "";

  cart.forEach(item=>{
    total += Number(item.price);
    document.getElementById("cartItems").innerHTML += `
      <p>${item.name} - â‚¹${item.price}</p>
    `;
  });

  document.getElementById("total").innerText = total;
}

// PLACE ORDER
window.placeOrder = function(){
  let message = "Hello Badari Fashions,%0A";
  cart.forEach(item=>{
    message += item.name + " - â‚¹" + item.price + "%0A";
  });

  window.open("https://wa.me/918179564372?text=" + message);
};

</script>

</body>
</html>
